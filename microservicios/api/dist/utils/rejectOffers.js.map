{"version":3,"file":"rejectOffers.js","sourceRoot":"/","sources":["utils/rejectOffers.ts"],"names":[],"mappings":";;;;AAEA,uDAAuD;AACvD,oGAA8E;AAC9E,2EAAyE;AAEzE,SAAgB,YAAY,CAC1B,WAAyB,EACzB,KAAa,EACb,SAAsB,EACtB,OAAa;IAEb,OAAO,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,MAAM,CAAC,MAAM,CAAC,CAAC,QAAQ,EAAE,KAAiB,EAAE,EAAE;QAChE,IACE,CAAA,KAAK,aAAL,KAAK,uBAAL,KAAK,CAAE,GAAG,CAAC,QAAQ,EAAE,OAAK,SAAS,aAAT,SAAS,uBAAT,SAAS,CAAE,GAAG,CAAC,QAAQ,EAAE,CAAA;YACnD,KAAK,CAAC,MAAM,KAAK,QAAQ,EACzB;YACA,MAAM,UAAU,GAAG;gBACjB,KAAK;gBACL,MAAM,EAAE,KAAK,CAAC,MAAM;gBACpB,KAAK,EAAE,oBAAoB;gBAC3B,OAAO,EAAE,aAAa,KAAK,CAAC,eAAe,sBAAsB;aAClE,CAAC;YACF,MAAM,gBAAgB,GAAG,IAAA,sBAAW,EAAC,KAAK,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;YAC3D,MAAM,YAAY,GAAG,IAAA,oCAAiB,EAAC,UAAU,CAAC,CAAC;YACnD,MAAM,WAAW,GAAG,gBAAgB,CAAC,gBAAgB,CACnD,EAAE,GAAG,EAAE,KAAK,CAAC,GAAG,EAAE,EAClB;gBACE,MAAM,EAAE,UAAU;aACnB,EACD,EAAE,OAAO,EAAE,CACZ,CAAC;YACF,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,gBAAgB,EAAE,WAAW,EAAE,YAAY,CAAC,CAAC,CAAC,CAAC;SAC3E;QACD,OAAO,QAAQ,CAAC;IAClB,CAAC,EAAE,EAAE,CAAC,CAAC;AACT,CAAC;AA9BD,oCA8BC","sourcesContent":["import { ILoanOffer } from '../components/loanOffer';\nimport { ILoanRequest } from '../components/loanRequest';\nimport { deleteBlock } from './walletService/cancelAd';\nimport * as loanOfferService from '../components/loanOffer/loanOffer.service';\nimport { sendNotifications } from './pushNotifications/sendNotification';\n\nexport function rejectOffers(\n  loanRequest: ILoanRequest,\n  token: string,\n  loanOffer?: ILoanOffer,\n  session?: any\n) {\n  return loanRequest?.offers.reduce((promises, offer: ILoanOffer) => {\n    if (\n      offer?._id.toString() !== loanOffer?._id.toString() &&\n      offer.status === 'active'\n    ) {\n      const paramsPush = {\n        token,\n        userId: offer.lender,\n        title: 'Oferta no aprobada',\n        message: `Tu oferta ${offer.referenceNumber} no ha sido aprobada`,\n      };\n      const deleteOfferBlock = deleteBlock(token, offer.blockId);\n      const pushRejected = sendNotifications(paramsPush);\n      const rejectOffer = loanOfferService.findOneAndUpdate(\n        { _id: offer._id },\n        {\n          status: 'rejected',\n        },\n        { session }\n      );\n      promises.push(Promise.all([deleteOfferBlock, rejectOffer, pushRejected]));\n    }\n    return promises;\n  }, []);\n}\n"]}