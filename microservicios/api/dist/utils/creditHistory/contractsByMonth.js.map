{"version":3,"file":"contractsByMonth.js","sourceRoot":"/","sources":["utils/creditHistory/contractsByMonth.ts"],"names":[],"mappings":";;;;AAAA,0DAA0B;AAC1B,6GAAuF;AAEvF,SAAsB,6BAA6B,CACjD,IAAY,EACZ,KAAa,EACb,MAAc;;;QAEd,MAAM,eAAe,GAAG,IAAA,eAAK,GAAE;aAC5B,IAAI,CAAC,IAAI,CAAC;aACV,KAAK,CAAC,KAAK,CAAC;aACZ,OAAO,CAAC,OAAO,CAAC;aAChB,MAAM,EAAE,CAAC;QAEZ,MAAM,cAAc,GAAG,IAAA,eAAK,GAAE;aAC3B,IAAI,CAAC,IAAI,CAAC;aACV,KAAK,CAAC,KAAK,CAAC;aACZ,KAAK,CAAC,OAAO,CAAC;aACd,MAAM,EAAE,CAAC;QAEZ,MAAM,aAAa,GAAG,MAAM,eAAe,CAAC,SAAS,CAAC;YACpD;gBACE,MAAM,EAAE;oBACN,QAAQ,EAAE,MAAM;oBAChB,SAAS,EAAE;wBACT,IAAI,EAAE,IAAI,IAAI,CAAC,eAAe,CAAC;wBAC/B,IAAI,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC;qBAC/B;iBACF;aACF;YACD;gBACE,MAAM,EAAE;oBACN,GAAG,EAAE,IAAI;oBACT,kBAAkB,EAAE;wBAClB,IAAI,EAAE,eAAe;qBACtB;iBACF;aACF;SACF,CAAC,CAAC;QAEH,OAAO,MAAA,aAAa,CAAC,CAAC,CAAC,0CAAE,kBAAkB,CAAC;;CAC7C;AAtCD,sEAsCC","sourcesContent":["import dayjs from 'dayjs';\nimport * as contractService from '../../components/contract/contract/contract.service';\n\nexport async function getAmountUserContractsByMonth(\n  year: number,\n  month: number,\n  userId: string\n) {\n  const firstDayOfMonth = dayjs()\n    .year(year)\n    .month(month)\n    .startOf('month')\n    .format();\n\n  const lastDayOfMonth = dayjs()\n    .year(year)\n    .month(month)\n    .endOf('month')\n    .format();\n\n  const userContracts = await contractService.aggregate([\n    {\n      $match: {\n        borrower: userId,\n        startDate: {\n          $gte: new Date(firstDayOfMonth),\n          $lte: new Date(lastDayOfMonth),\n        },\n      },\n    },\n    {\n      $group: {\n        _id: null,\n        sumAmountContracts: {\n          $sum: '$amountInUSDC',\n        },\n      },\n    },\n  ]);\n\n  return userContracts[0]?.sumAmountContracts;\n}\n"]}