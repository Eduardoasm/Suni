{"version":3,"file":"auth.controller.js","sourceRoot":"/","sources":["components/auth/auth.controller.ts"],"names":[],"mappings":"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","sourcesContent":["import browserDetect from 'browser-detect';\nimport type { Request, Response, NextFunction, CookieOptions } from 'express';\nimport { schemaComposer } from 'graphql-compose';\nimport {\n  ChangePasswordInput,\n  ResetPasswordInfo,\n  ResetPasswordInput,\n  SignInInput,\n  SignInType,\n  SignOutType,\n  TChangePasswordInput,\n  TResetPasswordInput,\n  TSignInInput,\n  CurrentUserRole,\n  TCreateAdminInput,\n  createAdminInput,\n  DeleteResultType,\n  TAdminDeleteUserInput,\n  AdminDeleteUserInput,\n  TSignOutInput,\n  SignOutInput,\n  UserWalletsType,\n  GetUserWalletsInput,\n  TGetUserWalletInput,\n  ValidateForKYCType,\n} from './auth.dto';\nimport { UserRole } from '../user/user/user.dto';\nimport * as authService from './auth.service';\n\nconst cookieConfig: CookieOptions =\n  process.env.NODE_ENV === 'development'\n    ? {\n        maxAge: 1000 * 60 * 60 * 24 * 365,\n      }\n    : {\n        secure: true,\n        sameSite: 'none',\n        httpOnly: true,\n        maxAge: 1000 * 60 * 60 * 24 * 365,\n        domain: 'suni.avilatek.com',\n      };\n\nconst createAdmin = schemaComposer.createResolver<\n  any,\n  {\n    data: TCreateAdminInput;\n  }\n>({\n  name: 'createAdmin',\n  kind: 'mutation',\n  description: 'Create new user admin',\n  type: UserRole,\n  args: {\n    data: createAdminInput,\n  },\n  async resolve({ args, context }) {\n    const token =\n      context.req.cookies?.token ?? context.req.headers?.['x-token'];\n    const browser = browserDetect(context.req.headers['user-agent']);\n    const user = await authService.createAdmin(args.data, token, browser);\n    return user;\n  },\n});\n\nconst signIn = schemaComposer.createResolver<\n  any,\n  {\n    data: TSignInInput;\n  }\n>({\n  name: 'signIn',\n  kind: 'mutation',\n  description: 'Sign In an user to the app',\n  type: SignInType,\n  args: {\n    data: SignInInput,\n  },\n  async resolve({ args, context }) {\n    const browser = browserDetect(context.req.headers['user-agent']);\n    const { user, token } = await authService.signIn(args.data, browser);\n    return { user, token };\n  },\n});\n\nconst signInAdmin = schemaComposer.createResolver<\n  any,\n  {\n    data: TSignInInput;\n  }\n>({\n  name: 'signInAdmin',\n  kind: 'mutation',\n  description: 'Sign In an admin to the app',\n  type: SignInType,\n  args: {\n    data: SignInInput,\n  },\n  async resolve({ args, context }) {\n    const browser = browserDetect(context.req.headers['user-agent']);\n    const { user, token } = await authService.signInAdmin(args.data, browser);\n    context.res.cookie('token', token, cookieConfig);\n    return { user, token };\n  },\n});\n\nconst signOut = schemaComposer.createResolver<\n  any,\n  {\n    data?: TSignOutInput;\n  }\n>({\n  name: 'SignOut',\n  kind: 'mutation',\n  description: 'Sign Out an user from the app',\n  type: SignOutType,\n  args: {\n    data: SignOutInput,\n  },\n  async resolve({ args, context }) {\n    const { data } = args;\n    const serviceResponse = await authService.signOut(data.token);\n\n    if (serviceResponse?.success) {\n      context.res.clearCookie('token', cookieConfig);\n      return { success: true };\n    }\n    return { success: false, message: serviceResponse?.message };\n  },\n});\n\nconst deleteUser = schemaComposer.createResolver({\n  name: 'deleteUser',\n  kind: 'mutation',\n  description: 'Logical deletion of user',\n  type: DeleteResultType,\n  args: {},\n  async resolve({ context }) {\n    const token =\n      context.req.cookies?.token ?? context.req.headers?.['x-token'];\n    const success = await authService.deleteUser(token);\n    context.res.clearCookie('token', cookieConfig);\n    return { success };\n  },\n});\n\nconst adminDeleteUser = schemaComposer.createResolver<\n  any,\n  {\n    data: TAdminDeleteUserInput;\n  }\n>({\n  name: 'adminDeleteUser',\n  kind: 'mutation',\n  description: 'Admin logical delete an user',\n  type: DeleteResultType,\n  args: {\n    data: AdminDeleteUserInput,\n  },\n  async resolve({ args, context }) {\n    const token =\n      context.req.cookies?.token ?? context.req.headers?.['x-token'];\n    const success = await authService.adminDeleteUser(args.data, token);\n    return { success };\n  },\n});\n\nconst currentUser = schemaComposer.createResolver({\n  name: 'currentUser',\n  kind: 'query',\n  description: 'Return the user object based on the token',\n  type: CurrentUserRole,\n  args: {},\n  async resolve({ context }) {\n    const token =\n      context.req.cookies?.token ?? context.req.headers?.['x-token'];\n    const { user } = await authService.currentUser(token);\n    return { user };\n  },\n});\n\nconst resetPassword = schemaComposer.createResolver<\n  any,\n  {\n    data: TResetPasswordInput;\n  }\n>({\n  name: 'resetPassword',\n  type: ResetPasswordInfo,\n  description: 'Reset Password',\n  kind: 'mutation',\n  args: {\n    data: ResetPasswordInput,\n  },\n  async resolve({ args, context }) {\n    try {\n      await authService.resetPassword(\n        args.data.email,\n        browserDetect(context.req.headers['user-agent'])\n      );\n      return { success: true };\n    } catch (err) {\n      return { err: err.message, success: false };\n    }\n  },\n});\n\nconst changePassword = schemaComposer.createResolver<\n  any,\n  {\n    data: TChangePasswordInput;\n  }\n>({\n  name: 'changePassword',\n  type: ResetPasswordInfo,\n  description: 'Change Password',\n  kind: 'mutation',\n  args: {\n    data: ChangePasswordInput,\n  },\n  async resolve({ args }) {\n    try {\n      await authService.changePassword(args.data);\n      return { success: true };\n    } catch (err) {\n      return { success: false, err: err.message };\n    }\n  },\n});\n\nconst getUserWallets = schemaComposer.createResolver<\n  any,\n  {\n    data: TGetUserWalletInput;\n  }\n>({\n  name: 'getUserWallets',\n  kind: 'query',\n  description: 'Return user wallets info',\n  type: UserWalletsType,\n  args: {\n    data: GetUserWalletsInput,\n  },\n  async resolve({ args, context }) {\n    const token = context.req.headers?.authorization;\n    const userWallets = await authService.getUserWallets(token, args?.data);\n    return userWallets;\n  },\n});\n\nconst validateForKYC = schemaComposer.createResolver<any>({\n  name: 'validateForKYC',\n  kind: 'query',\n  description: 'Validates if user is allowed to do kyc or not',\n  type: ValidateForKYCType,\n  async resolve({ context }) {\n    const token = context.req.headers?.authorization;\n    const response = await authService.validateForKYC(token);\n    return response;\n  },\n});\n\nexport const authQueries = {\n  currentUser,\n  getUserWallets,\n  validateForKYC,\n};\n\nexport const authMutations = {\n  changePassword,\n  resetPassword,\n  signOut,\n  signIn,\n  createAdmin,\n  signInAdmin,\n  deleteUser,\n  adminDeleteUser,\n};\n\n// REST Controller\n\nexport async function currentUserController(\n  req: Request,\n  res: Response,\n  next: NextFunction\n) {\n  try {\n    const { user } = await authService.currentUser(req.body);\n    return res.status(200).json({ success: true, user });\n  } catch (err) {\n    res.status(500).json({ success: false, err: 'Internal Server Error' });\n  }\n}\n\nexport async function changePasswordController(\n  req: Request,\n  res: Response,\n  next: NextFunction\n) {\n  try {\n    await authService.changePassword(req.body.email);\n    return res.status(200).json({ success: true });\n  } catch (err) {\n    res.status(500).json({ success: false, err: 'Internal Server Error' });\n  }\n}\n\nexport async function resetPasswordController(\n  req: Request,\n  res: Response,\n  next: NextFunction\n) {\n  try {\n    await authService.resetPassword(\n      req.body.email,\n      browserDetect(req.headers['user-agent'])\n    );\n    return res.status(200).json({ success: true });\n  } catch (err) {\n    res.status(500).json({ success: false, err: 'Internal Server Error' });\n  }\n}\n\nexport async function currentUserRest(\n  req: Request,\n  res: Response,\n  next: NextFunction\n) {\n  try {\n    const user = await authService.currentUser(req.headers.authorization);\n    return res.status(200).json({ user });\n  } catch (error) {\n    console.log(error, 'error in api currentUser');\n    res.status(500).json({ success: false, err: 'Internal Server Error' });\n  }\n}\n\nexport async function signOutController(\n  req: Request,\n  res: Response,\n  next: NextFunction\n) {\n  try {\n    // TODO: Eliminar la sesion del usuario\n    res.clearCookie('token', cookieConfig);\n    return res.status(200).json({ success: true });\n  } catch (err) {\n    res.status(500).json({ success: false, err: 'Internal Server Error' });\n  }\n}\n\nexport async function signInController(\n  req: Request,\n  res: Response,\n  next: NextFunction\n) {\n  try {\n    const browser = browserDetect(req.headers['user-agent']);\n    const { user, token } = await authService.signIn(req.body, browser);\n    return res.status(200).json({ success: true, user, token });\n  } catch (err) {\n    res.status(500).json({ success: false, err: 'Internal Server Error' });\n  }\n}\n"]}