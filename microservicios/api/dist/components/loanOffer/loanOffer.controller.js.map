{"version":3,"file":"loanOffer.controller.js","sourceRoot":"/","sources":["components/loanOffer/loanOffer.controller.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable import/no-cycle */\nimport type { Request, Response, NextFunction } from 'express';\nimport { schemaComposer } from 'graphql-compose';\nimport { LoanOfferTC } from './loanOffer.model';\nimport * as loanOfferService from './loanOffer.service';\nimport {\n  CancelLoanOfferInput,\n  GetMyLoanOffersInput,\n  LoanOfferType,\n  LoanOfferTypePlural,\n} from './loanOffer.dto';\nimport { buildPaginationType } from '../../utils/pagination';\n\nconst LoanOffersPaginationType = buildPaginationType('LoanOffer');\n\nconst getAllLoansOffered = schemaComposer.createResolver<any>({\n  name: 'getAllLoansOffered',\n  kind: 'query',\n  description: 'get all loans offereds',\n  type: LoanOfferTypePlural,\n  async resolve({ context }) {\n    const token = context.req.headers?.authorization;\n    const loansOffered = await loanOfferService.getAllLoanOffers(token);\n    return loansOffered;\n  },\n});\n\nconst cancelLoanOffer = schemaComposer.createResolver<any>({\n  name: 'cancelLoanOffer',\n  kind: 'mutation',\n  description: 'cancel Loan offer',\n  type: LoanOfferType,\n  args: {\n    data: CancelLoanOfferInput,\n  },\n  async resolve({ args, context }) {\n    const token = context.req.headers?.authorization;\n    const loansOffered = await loanOfferService.cancelOffer(args?.data, token);\n    return loansOffered;\n  },\n});\n\nexport const getMyLoanOffers = schemaComposer.createResolver<any>({\n  name: 'getMyLoanOffers',\n  kind: 'query',\n  description: 'get all loan offers of user',\n  type: LoanOffersPaginationType,\n  args: {\n    data: GetMyLoanOffersInput,\n  },\n  async resolve({ args, context }) {\n    const token = context.req.headers?.authorization;\n    const loanOffers = await loanOfferService.getMyLoanOffers(\n      args?.data,\n      token\n    );\n    return loanOffers;\n  },\n});\n\nconst loanOfferQueries = {\n  loanOffer: LoanOfferTC.mongooseResolvers.findOne(),\n  loanOffers: LoanOfferTC.mongooseResolvers.findMany({\n    limit: { defaultValue: 1000000 },\n  }),\n  loanOfferPagination: LoanOfferTC.mongooseResolvers.pagination(),\n  getAllLoansOffered,\n  getMyLoanOffers,\n};\n\nconst loanOfferMutations = {\n  updateloanOffer: LoanOfferTC.mongooseResolvers.updateOne(),\n  cancelLoanOffer,\n};\n\n// REST Controller\n\nexport async function getAll(req: Request, res: Response, next: NextFunction) {\n  try {\n    const loanOffer = await loanOfferService.find({});\n    return res.status(200).json({ success: true, loanOffer });\n  } catch (err) {\n    res.status(500).json({ err: 'Internal server error', success: false });\n  }\n}\n\nexport async function getOne(req: Request, res: Response, next: NextFunction) {\n  try {\n    const loanOffer = await loanOfferService.findOne({\n      _id: req.params._id,\n    });\n    return res.status(200).json({ success: true, loanOffer });\n  } catch (err) {\n    res.status(500).json({ err: 'Internal server error', success: false });\n  }\n}\n\nexport async function updateOne(\n  req: Request,\n  res: Response,\n  next: NextFunction\n) {\n  try {\n    const loanOffer = await loanOfferService.updateOne(\n      { _id: req.params._id },\n      req.body\n    );\n    return res.status(200).json({ success: true, loanOffer });\n  } catch (err) {\n    res.status(500).json({ err: 'Internal server error', success: false });\n  }\n}\n\nexport async function pagination(\n  req: Request,\n  res: Response,\n  next: NextFunction\n) {\n  try {\n    const data = await loanOfferService.pagination(\n      Number(req.params.page),\n      Number(req.params.perPage)\n    );\n    return res.status(200).json({ success: true, pagination: data });\n  } catch (err) {\n    res.status(500).json({ err: 'Internal server error', success: false });\n  }\n}\n\nexport { loanOfferQueries, loanOfferMutations };\n"]}