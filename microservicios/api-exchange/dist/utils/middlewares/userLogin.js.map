{"version":3,"file":"userLogin.js","sourceRoot":"/","sources":["utils/middlewares/userLogin.ts"],"names":[],"mappings":";;;;AAGA,0DAA0B;AAC1B,mDAAsC;AACtC,oDAAiD;AAEjD;;GAEG;AAEU,QAAA,QAAQ,GAAG,IAAA,qBAAI,GAAE,CAC5B,CAAO,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAgB,EAAE;IAClD,MAAM,KAAK,GAAG,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,aAAa,CAAC;IAEhD,IAAI,CAAC,KAAK,EAAE;QACV,MAAM,IAAI,6BAAa,CAAC,oBAAoB,CAAC,CAAC;KAC/C;IAED,MAAM,MAAM,GAAG;QACb,MAAM,EAAE,KAAK;QACb,OAAO,EAAE,OAAO,CAAC,GAAG,CAAC,WAAW;QAChC,GAAG,EAAE,gBAAgB;QACrB,OAAO,EAAE;YACP,aAAa,EAAE,UAAU,KAAK,EAAE;SACjC;KACF,CAAC;IAEF,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,eAAK,EAAC,MAAM,CAAC,CAAC;IAErC,IAAI,CAAC,IAAI,EAAE;QACT,MAAM,IAAI,6BAAa,CAAC,sBAAsB,CAAC,CAAC;KACjD;IAED,OAAO,IAAI,CAAC;AACd,CAAC,CAAA,CACF,CAAC","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nimport mongoose from 'mongoose';\nimport { ObjectId } from 'mongodb';\nimport axios from 'axios';\nimport { rule } from 'graphql-shield';\nimport { NoSentryError } from '../NoSentryError';\n\n/**\n * authorization for the user in the app\n */\n\nexport const userInfo = rule()(\n  async (parent, args, context, info): Promise<any> => {\n    const token = context.req.headers.authorization;\n\n    if (!token) {\n      throw new NoSentryError('Token not provided');\n    }\n\n    const config = {\n      method: 'get',\n      baseURL: process.env.SERVICE_URL,\n      url: '/auth/userinfo',\n      headers: {\n        authorization: `Bearer ${token}`,\n      },\n    };\n\n    const { data } = await axios(config);\n\n    if (!data) {\n      throw new NoSentryError('error obtaining data');\n    }\n\n    return true;\n  }\n);\n"]}