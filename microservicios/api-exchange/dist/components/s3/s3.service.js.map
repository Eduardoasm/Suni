{"version":3,"file":"s3.service.js","sourceRoot":"/","sources":["components/s3/s3.service.ts"],"names":[],"mappings":";;;;AAAA,sDAAsD;AACtD,kDAA0D;AAC1D,wEAA6D;AAG7D,SAAsB,aAAa,CAAC,IAAkB;;;QACpD,MAAM,UAAU,GAAG,MAAA,MAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,GAAG,0CAAE,eAAe,mCAAI,EAAE,CAAC;QACvD,MAAM,EAAE,GAAG,IAAI,cAAE,CAAC;YAChB,WAAW,EAAE;gBACX,WAAW,EAAE,OAAO,CAAC,GAAG,CAAC,iBAAiB;gBAC1C,eAAe,EAAE,OAAO,CAAC,GAAG,CAAC,qBAAqB;aACnD;YACD,QAAQ,EAAE,qCAAqC;YAC/C,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,UAAU;SAC/B,CAAC,CAAC;QACH,MAAM,OAAO,GAAG,IAAI,4BAAgB,CAAC;YACnC,MAAM,EAAE,UAAU;YAClB,GAAG,EAAE,IAAI,CAAC,QAAQ;YAClB,WAAW,EAAE,IAAI,CAAC,QAAQ;YAC1B,GAAG,EAAE,aAAa;SACnB,CAAC,CAAC;QACH,MAAM,UAAU,GAAG,EAAE,GAAG,EAAE,CAAC;QAC3B,MAAM,aAAa,GAAG,MAAM,IAAA,mCAAY,EAAC,EAAE,EAAE,OAAO,EAAE;YACpD,SAAS,EAAE,UAAU;SACtB,CAAC,CAAC;QACH,MAAM,GAAG,GAAG,4CAA4C,IAAI,CAAC,QAAQ,EAAE,CAAC;QACxE,OAAO;YACL,aAAa;YACb,GAAG;SACJ,CAAC;;CACH;AAzBD,sCAyBC","sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nimport { S3, PutObjectCommand } from '@aws-sdk/client-s3';\nimport { getSignedUrl } from '@aws-sdk/s3-request-presigner';\nimport { TSignS3Input } from './s3.dto';\n\nexport async function signS3Service(body: TSignS3Input) {\n  const bucketName = process?.env?.AWS_BUCKET_NAME ?? '';\n  const s3 = new S3({\n    credentials: {\n      accessKeyId: process.env.AWS_ACCESS_KEY_ID,\n      secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY,\n    },\n    endpoint: 'https://nyc3.digitaloceanspaces.com',\n    region: process.env.AWS_REGION,\n  });\n  const command = new PutObjectCommand({\n    Bucket: bucketName,\n    Key: body.filename,\n    ContentType: body.filetype,\n    ACL: 'public-read',\n  });\n  const oneHrInSec = 60 * 60;\n  const signedRequest = await getSignedUrl(s3, command, {\n    expiresIn: oneHrInSec,\n  });\n  const url = `https://suni.nyc3.digitaloceanspaces.com/${body.filename}`;\n  return {\n    signedRequest,\n    url,\n  };\n}\n"]}