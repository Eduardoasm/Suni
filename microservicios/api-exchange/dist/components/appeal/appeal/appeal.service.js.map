{"version":3,"file":"appeal.service.js","sourceRoot":"/","sources":["components/appeal/appeal/appeal.service.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable import/no-cycle */\nimport mongoose from 'mongoose';\nimport type {\n  FilterQuery,\n  ProjectionType,\n  QueryOptions,\n  UpdateQuery,\n  UpdateWithAggregationPipeline,\n} from 'mongoose';\nimport { IAppeal, Appeal } from './appeal.model';\nimport { NoSentryError, paginateModel } from '../../../utils';\nimport * as transactionService from '../../transaction/transaction.service';\nimport { TCancelAppeal, TCreateAppeal } from './appeal.dto';\nimport * as chatService from '../../streamChat/streamChat.service';\nimport { getUser } from '../../../utils/walletService/userWau';\nimport { sendEmail } from '../../../utils/emails/sendEmail';\nimport { TManageCryptoAdmin } from '../../transaction';\nimport * as listingService from '../../listing/listing/listing.service';\nimport { unlockBalance } from '../../../utils/walletService/amountUnlock';\nimport { deleteAd } from '../../../utils/walletService/cancelAd';\nimport * as bestPriceService from '../../bestPrice/bestPrice.service';\nimport { createNotification } from '../../../utils/avilaServices/createNotification';\nimport * as currencyService from '../../currency/currency.service';\n\nexport async function findOne(\n  filter?: FilterQuery<IAppeal>,\n  projection?: ProjectionType<IAppeal> | null,\n  options?: QueryOptions<IAppeal> | null\n) {\n  return Appeal.findOne(filter, projection, options).exec();\n}\n\nexport async function find(\n  filter?: FilterQuery<IAppeal>,\n  projection?: ProjectionType<IAppeal> | null,\n  options?: QueryOptions<IAppeal> | null\n) {\n  return Appeal.find(filter, projection, options).exec();\n}\n\nfunction getAppealReason(reason) {\n  switch (reason) {\n    case 'notConfirmed':\n      return 'Pago no confirmado';\n    case 'confirmedNotReceived':\n      return 'Cripto no recibido';\n    case 'confirmedNotReleased':\n      return 'Cripto no liberado';\n    default:\n      return 'Pago confirmado, dinero no recibido';\n  }\n}\n\nexport async function findAppeal(\n  token: string,\n  filter?: FilterQuery<IAppeal>,\n  projection?: ProjectionType<IAppeal> | null,\n  options?: QueryOptions<IAppeal> | null\n) {\n  const appealData = await Appeal.findOne(filter, projection, options).populate(\n    {\n      path: 'transaction',\n      model: 'Transaction',\n      populate: {\n        path: 'listing',\n        model: 'Listing',\n        populate: [\n          {\n            path: 'currency',\n            model: 'Currency',\n          },\n          {\n            path: 'asset',\n            model: 'Asset',\n          },\n        ],\n      },\n    }\n  );\n  const reason = getAppealReason(appealData?.reason);\n  return {\n    ...(appealData as any)._doc,\n    reason,\n  };\n}\n\nexport async function getAllAppealInfo(\n  token: string,\n  filter?: FilterQuery<IAppeal>,\n  projection?: ProjectionType<IAppeal> | null,\n  options?: QueryOptions<IAppeal> | null\n) {\n  const appealsData = await Appeal.find(filter, projection, options)\n    .populate({\n      path: 'transaction',\n      model: 'Transaction',\n      populate: {\n        path: 'listing',\n        model: 'Listing',\n        populate: [\n          {\n            path: 'currency',\n            model: 'Currency',\n          },\n          {\n            path: 'asset',\n            model: 'Asset',\n          },\n        ],\n      },\n    })\n    .exec();\n  const appeals = [];\n  for (const appeal of appealsData) {\n    const reason = getAppealReason(appeal?.reason);\n    const formData = {\n      ...(appeal as any)?._doc,\n      reason,\n    };\n    appeals.push(formData);\n  }\n  return appeals;\n}\n\nexport async function updateOne(\n  filter: FilterQuery<IAppeal>,\n  update: UpdateQuery<IAppeal> | UpdateWithAggregationPipeline,\n  options?: QueryOptions<IAppeal> | null\n) {\n  return Appeal.updateOne(filter, update, options).exec();\n}\n\nexport async function create(body: TCreateAppeal, token: string) {\n  const { data: user } = await getUser(token);\n\n  const session = await mongoose.startSession();\n\n  try {\n    session.startTransaction();\n\n    // const countryAvailable = await countryService.findOne({\n    //   code: user.country,\n    //   active: true,\n    //   disabled: false,\n    // });\n    // if (!countryAvailable)\n    //   throw new NoSentryError(\n    //     'Access denied, the country is disabled to the app'\n    //   );\n    const transaction = await transactionService.findOne(\n      {\n        _id: body.transaction,\n      },\n      null,\n      { session }\n    );\n\n    const STATUS_APPEAL = 'active';\n\n    const appealOwner = {\n      id: user.id,\n      email: user.email,\n      name: user?.metamapStatus?.dni_firstName ?? user?.name,\n      lastname: user?.metamapStatus?.dni_lastName ?? user?.lastname,\n    };\n\n    const createdAppeal = await Appeal.create(\n      [\n        {\n          transaction: transaction._id,\n          description: body.description,\n          paymentReceipt: body.paymentReceipt,\n          status: STATUS_APPEAL,\n          reason: body.reason,\n          appealOwner,\n        },\n      ],\n      { session }\n    );\n\n    transaction.appealed = true;\n    transaction.appealedBy = appealOwner;\n    await transaction.save();\n\n    const userMakerName = transaction?.maker?.name;\n\n    const userMakerLastName = transaction?.maker?.lastname;\n\n    const variablesMaker = {\n      name: `${userMakerName} ${userMakerLastName}`,\n    };\n\n    const userMaker = transaction?.maker?.email;\n\n    await sendEmail(\n      'transaction_appeal_filed',\n      token,\n      variablesMaker,\n      null,\n      userMaker\n    );\n\n    const userTakerName = transaction?.taker?.name;\n\n    const userTakerLastName = transaction?.taker?.lastname;\n\n    const variablesTaker = {\n      name: `${userTakerName} ${userTakerLastName}`,\n    };\n\n    const userTaker = transaction?.taker?.email;\n\n    await sendEmail(\n      'transaction_appeal_filed',\n      token,\n      variablesTaker,\n      null,\n      userTaker\n    );\n\n    const channel = await chatService.getChannelById({\n      channelId: createdAppeal[0].transaction._id.toString(),\n    });\n    const text = 'An appeal has been created';\n    const message = {\n      text,\n      user: { id: user.id },\n      type: 'system',\n    };\n    await channel.sendMessage(message);\n\n    await session.commitTransaction();\n\n    await createNotification(\n      // notification Transacción en apelación\n      {\n        messageTemplateId: '196113595656315',\n        model: 'transaction',\n        module: 'exchange',\n        object: transaction?._id,\n        recipientId:\n          user?.id === transaction?.maker.id\n            ? transaction?.taker.id\n            : transaction?.maker.id,\n        senderId: user?.id,\n      },\n      token\n    );\n\n    return createdAppeal[0];\n  } catch (error) {\n    await session.abortTransaction();\n    throw new NoSentryError(error);\n  } finally {\n    session.endSession();\n  }\n}\n\nexport async function cancelAppeal(body: TCancelAppeal, token: string) {\n  const { data: user } = await getUser(token);\n\n  const session = await mongoose.startSession();\n\n  try {\n    session.startTransaction();\n    // const countryAvailable = await countryService.findOne({\n    //   code: user.country,\n    //   active: true,\n    //   disabled: false,\n    // });\n    // if (!countryAvailable)\n    //   throw new NoSentryError(\n    //     'Access denied, the country is disabled to the app'\n    //   );\n\n    const STATUS_APPEAL_CANCELED = 'canceled';\n\n    const appeal = await Appeal.findOne(\n      {\n        transaction: body.transactionId,\n      },\n      null,\n      { session }\n    );\n\n    const transaction = await transactionService.findOne(\n      {\n        _id: body.transactionId,\n      },\n      null,\n      { session }\n    );\n\n    if (appeal?.appealOwner?.id !== user?.id)\n      throw new NoSentryError('Invalid user for appeal');\n\n    appeal.status = STATUS_APPEAL_CANCELED;\n    await appeal.save();\n\n    transaction.appealed = false;\n    await transaction.save();\n\n    const channel = await chatService.getChannelById({\n      channelId: appeal.transaction._id.toString(),\n    });\n    const text = 'An appeal has been canceled';\n    const message = {\n      text,\n      user: { id: user.id },\n      type: 'system',\n    };\n    await channel.sendMessage(message);\n\n    await session.commitTransaction();\n\n    await createNotification(\n      // notification Apelación resuelta\n      {\n        messageTemplateId: '753245640186065',\n        model: 'transaction',\n        module: 'exchange',\n        object: transaction?._id,\n        recipientId:\n          user?.id === transaction?.maker.id\n            ? transaction?.taker.id\n            : transaction?.maker.id,\n        senderId: user?.id,\n      },\n      token\n    );\n\n    return appeal;\n  } catch (error) {\n    await session.abortTransaction();\n    throw new NoSentryError(error);\n  } finally {\n    session.endSession();\n  }\n}\n\nexport async function pagination(\n  page: number,\n  perPage: number,\n  filter?: FilterQuery<IAppeal>,\n  projection?: ProjectionType<IAppeal> | null,\n  options?: QueryOptions<IAppeal> | null\n) {\n  return paginateModel(page, perPage, Appeal, filter, projection, options);\n}\n\nexport async function manageCryptoAdmin(body: TManageCryptoAdmin) {\n  const session = await mongoose.startSession();\n\n  try {\n    session.startTransaction();\n\n    const transaction = await transactionService.findOne(\n      {\n        _id: body.transactionId,\n      },\n      null,\n      { session }\n    );\n\n    const appealFound = await findOne(\n      {\n        transaction: body.transactionId,\n      },\n      null,\n      { session }\n    );\n\n    if (!transaction) throw new NoSentryError('Transaction not found');\n\n    const listing = await listingService.findOne(\n      { _id: transaction.listing },\n      null,\n      { session }\n    );\n\n    const currency = await currencyService.findOne({\n      _id: listing?.currency._id,\n    });\n\n    const token = process.env.TOKEN_ADMIN_SUNI;\n\n    if (body?.decisionType === 'release') {\n      if (listing?.type === 'sale') {\n        await unlockBalance({\n          token,\n          toWallet: transaction?.selectedWallet,\n          amount: transaction?.amount,\n          takerFee: transaction.takerFee,\n          blockId: listing?.loanAdId,\n          description: `Release of funds for ${transaction?.amount} ${currency?.symbol} in listing #${listing?.referenceNumber}`,\n        });\n      } else {\n        await unlockBalance({\n          token,\n          toWallet: listing?.selectedWallet?.address,\n          amount: transaction?.amount,\n          takerFee: transaction?.takerFee,\n          blockId: transaction?.loanAdId,\n          description: `Release of funds for ${transaction?.amount} ${currency?.symbol} in listing #${listing?.referenceNumber}`,\n        });\n      }\n\n      await createNotification(\n        // notification Apelación resuelta\n        // message: se han liberado los fondos a tu wallet...\n        {\n          messageTemplateId: '843268822926754',\n          model: 'transaction',\n          module: 'exchange',\n          object: transaction?._id,\n          recipientId:\n            listing?.type === 'sale'\n              ? transaction?.taker?.id\n              : listing?.maker?.id,\n        },\n        token\n      );\n\n      await createNotification(\n        // notification Apelación resuelta\n        // message: se han liberado los fondos a tu contraparte..\n        {\n          messageTemplateId: '473347693704116',\n          model: 'transaction',\n          module: 'exchange',\n          object: transaction?._id,\n          recipientId:\n            listing?.type === 'sale'\n              ? transaction?.maker?.id\n              : transaction?.taker?.id,\n        },\n        token\n      );\n\n      transaction.status = 'successful';\n    } else {\n      let listingPrice: number = listing?.price;\n\n      if (listing?.bestPricePercentage) {\n        const bestPrice = await bestPriceService.findOne({\n          currencyId: listing?.currency._id,\n          assetId: listing?.asset._id,\n        });\n        if (listing?.type === 'sale')\n          listingPrice = listing.bestPricePercentage * bestPrice.saleBestPrice;\n        else\n          listingPrice =\n            listing.bestPricePercentage * bestPrice.purchaseBestPrice;\n      }\n      if (listing?.type === 'purchase') {\n        await deleteAd(token, transaction?.loanAdId);\n      }\n      listing.amount += transaction.amount; // aumentamos el amount de el listing ya que se devolvieron los fondos\n      listing.maxAmountAsset =\n        listing.maxAmountAsset + transaction.amount >\n        listing.originalMaxAssetAmount\n          ? listing.originalMaxAssetAmount\n          : listing.maxAmountAsset + transaction.amount;\n      listing.maxAmount = listing.maxAmountAsset * listingPrice;\n      listing.active = true; // para no hacer condicional si esta en false el listing por si entro en default se cambia a true\n\n      await createNotification(\n        // notification Apelación resuelta devolución\n        // message: se han devuelto los fondos a tu wallet...\n        {\n          messageTemplateId: '149023089927323',\n          model: 'transaction',\n          module: 'exchange',\n          object: transaction?._id,\n          recipientId:\n            listing?.type === 'sale'\n              ? listing?.maker?.id\n              : transaction?.taker?.id,\n        },\n        token\n      );\n\n      await createNotification(\n        // notification Apelación resuelta devolución\n        // message: se han devuelto los fondos a tu contraparte...\n        {\n          messageTemplateId: '807577023896948',\n          model: 'transaction',\n          module: 'exchange',\n          object: transaction?._id,\n          recipientId:\n            listing?.type === 'sale'\n              ? transaction?.taker?.id\n              : listing?.maker?.id,\n        },\n        token\n      );\n\n      transaction.status = 'cancelled';\n    }\n    await transaction.save();\n\n    appealFound.status = 'resolved';\n    await appealFound.save();\n\n    listing.status =\n      listing?.amount < listing?.minAmountAsset ? 'default' : 'active';\n    await listing.save();\n\n    await session.commitTransaction();\n\n    return transaction;\n  } catch (error) {\n    await session.abortTransaction();\n    throw new NoSentryError(error);\n  } finally {\n    session.endSession();\n  }\n}\n"]}